---
title: "Lending Club - Macro Effect"
output: html_notebook
---
 _Effect of Macro factors such as Unemployment Rate on Lending Club Loans_

#### Load Libraries
```{r}
library(data.table)
library(tidyverse)
library(lubridate)
library(survival)
library(survminer)
```

---

#### Load the Sample Data
Sample Data is for loans issues from 2012 through to 2015 onwards in the state of California with a 36 month term. A random sample of 1000 such loans is chosen for the analysis
```{r}
loan_sample<-read.csv("Sample Loans CA 36 2012_2015.csv", header=T)
head(loan_sample)
```

---

#### Select the columns to fit a model

- Remove records for loan status after Oct 2016 (inclusive) to avoid dealing with Delinquent loans
- Normalize Unemployment Rate at begin date and interest rate columns by subtracting means
- Select the columns which are going to be used in the model only
- Factorize the age of the loan

```{r}
loan_sample_model<-as.tbl(loan_sample)%>%
    filter(as.Date(MONTH_BEGIN_PAY_DT,origin=Sys.Date()) < 
               as.Date("2016-10-01",origin=Sys.Date()))%>%
    select(id,int_rate,MONTH.AGE.BEGIN,DEFAULT,UNEMP.RT.BEGIN_DT)%>%
    mutate(int_rate = int_rate-mean(int_rate))%>%
    mutate(UNEMP.RT.BEGIN_DT = UNEMP.RT.BEGIN_DT-mean(UNEMP.RT.BEGIN_DT))%>%
    mutate(MONTH.AGE.BEGIN = as.factor(MONTH.AGE.BEGIN))

head(loan_sample_model)
```

---

#### Fit a Linear Model
```{r}
loan_linear_mdl<-lm(DEFAULT ~ int_rate + UNEMP.RT.BEGIN_DT+MONTH.AGE.BEGIN - 1,
                     data = loan_sample_model)

summary(loan_linear_mdl)

```

---

#### Plotting Baseline Hazard Rate for California Loans
```{r}
plot(x = loan_linear_mdl$xlevels$MONTH.AGE.BEGIN,
     y = loan_linear_mdl$coefficients[-(1:2)],
     type = 'h',
     col = 'blue',
     xlab = "Age of Loan (months)",
     ylab = "Default Rate",
     main = "California Lending Club Loans Sample (2012-2015)")
```
